<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matrices - √(Raiz) Cuadrada²</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Open+Sans:wght@400;600;700&display=swap');

        body { 
            background: white; font-family: 'Open Sans', sans-serif; 
            display: flex; justify-content: center; padding: 20px; color: #333;
        }

        .calculadora-moderna {
            max-width: 900px; width: 100%; padding: 40px;
            background: #F2F2F2; border-radius: 40px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.05);
        }

        .header-section { text-align: center; margin-bottom: 30px; }
        .header-section h1 { font-size: 28px; margin: 0; font-family: 'Playfair Display', serif; }
        .header-section p { font-size: 18px; font-weight: 600; font-family: 'Playfair Display', serif; margin: 5px 0; }

        /* CONTENEDOR DE MATRIZ */
        .matrix-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: white;
            padding: 30px;
            border-radius: 30px;
            border: 1px solid #ddd;
            margin-bottom: 25px;
        }

        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .matrix-grid input {
            width: 80px;
            height: 60px;
            border-radius: 15px;
            border: 1px solid #ccc;
            text-align: center;
            font-size: 18px;
            font-weight: 600;
            background: #fafafa;
            transition: 0.3s;
        }

        .matrix-grid input:focus {
            border-color: #000;
            background: white;
            outline: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }

        /* RESULTADOS */
        .results-box {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }

        .res-card {
            background: white;
            padding: 20px;
            border-radius: 25px;
            border: 1px solid #ddd;
            text-align: center;
        }

        .res-card h3 { font-size: 14px; color: #888; margin-top: 0; text-transform: uppercase; }
        .det-val { font-size: 24px; font-weight: 700; }
        
        .inverse-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            font-size: 13px;
            font-weight: 700;
        }

        .btn-calc { 
            width: 100%; padding: 18px; background: black; color: white; border: none; 
            border-radius: 35px; font-weight: 700; cursor: pointer; margin-top: 10px;
            font-size: 16px; transition: 0.3s;
        }
        .btn-calc:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        #graph-container { 
            background: white; border-radius: 30px; border: 1px solid #ddd; 
            height: 400px; position: relative; overflow: hidden; margin-top: 20px;
        }

        /* BOTÓN DESCARGA PÍLDORA */
        .download-container { display: flex; justify-content: center; margin-top: 25px; }

        .btn-download-pill {
            background: white; border: 1px solid #e0e0e0; border-radius: 50px;
            padding: 12px 35px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: 0.3s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            font-family: 'Open Sans', sans-serif; font-weight: 700; font-size: 15px; color: #000;
        }
        .btn-download-pill:hover { background: #fafafa; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
        .btn-download-pill svg { width: 20px; height: 20px; }

    </style>
</head>
<body>

<div class="calculadora-moderna">
    <div class="header-section">
        <h1>Análisis de Matrices 3x3</h1>
        <p>√(Raiz) Cuadrada²</p>
    </div>

    <div class="matrix-container">
        <div class="matrix-grid" id="matrix-input">
            <input type="number" value="1" id="m00"> <input type="number" value="2" id="m01"> <input type="number" value="3" id="m02">
            <input type="number" value="0" id="m10"> <input type="number" value="1" id="m11"> <input type="number" value="4" id="m12">
            <input type="number" value="5" id="m20"> <input type="number" value="6" id="m21"> <input type="number" value="0" id="m22">
        </div>
        <button class="btn-calc" onclick="processMatrix()">Calcular e Interactuar</button>
    </div>

    <div class="results-box">
        <div class="res-card">
            <h3>Determinante |A|</h3>
            <div id="det-result" class="det-val">1</div>
        </div>
        <div class="res-card">
            <h3>Matriz Inversa A⁻¹</h3>
            <div id="inv-result" class="inverse-grid">
                </div>
        </div>
    </div>

    <div id="graph-container">
        <div id="plot-matrix" style="width:100%; height:100%;"></div>
    </div>

    <div class="download-container">
        <button class="btn-download-pill" onclick="downloadPlot()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
            Descargar PNG
        </button>
    </div>
</div>

<script>
    const watermarkText = "√(Raiz) Cuadrada²";

    function getMatrix() {
        return [
            [parseFloat(document.getElementById('m00').value)||0, parseFloat(document.getElementById('m01').value)||0, parseFloat(document.getElementById('m02').value)||0],
            [parseFloat(document.getElementById('m10').value)||0, parseFloat(document.getElementById('m11').value)||0, parseFloat(document.getElementById('m12').value)||0],
            [parseFloat(document.getElementById('m20').value)||0, parseFloat(document.getElementById('m21').value)||0, parseFloat(document.getElementById('m22').value)||0]
        ];
    }

    function calculateDeterminant(m) {
        return m[0][0] * (m[1][1] * m[2][2] - m[1][2] * m[2][1]) -
               m[0][1] * (m[1][0] * m[2][2] - m[1][2] * m[2][0]) +
               m[0][2] * (m[1][0] * m[2][1] - m[1][1] * m[2][0]);
    }

    function calculateInverse(m) {
        const det = calculateDeterminant(m);
        if (Math.abs(det) < 0.000001) return null;

        const inv = [
            [
                (m[1][1] * m[2][2] - m[1][2] * m[2][1]) / det,
                -(m[0][1] * m[2][2] - m[0][2] * m[2][1]) / det,
                (m[0][1] * m[1][2] - m[0][2] * m[1][1]) / det
            ],
            [
                -(m[1][0] * m[2][2] - m[1][2] * m[2][0]) / det,
                (m[0][0] * m[2][2] - m[0][2] * m[2][0]) / det,
                -(m[0][0] * m[1][2] - m[0][2] * m[1][0]) / det
            ],
            [
                (m[1][0] * m[2][1] - m[1][1] * m[2][0]) / det,
                -(m[0][0] * m[2][1] - m[0][1] * m[2][0]) / det,
                (m[0][0] * m[1][1] - m[0][1] * m[1][0]) / det
            ]
        ];
        return inv;
    }

    function updatePlot(m) {
        const data = [{
            z: m,
            x: ['C1', 'C2', 'C3'],
            y: ['F3', 'F2', 'F1'], // Invertido para que F1 quede arriba
            type: 'heatmap',
            colorscale: 'Greys',
            showscale: true,
            text: m.map(row => row.map(val => val.toString())),
            texttemplate: "%{z}",
            font: { family: 'Open Sans', weight: 'bold' }
        }];

        const layout = {
            title: { text: 'Distribución de Valores (Matriz A)', font: { family: 'Playfair Display', size: 20 } },
            margin: { t: 50, b: 50, l: 50, r: 50 },
            paper_bgcolor: 'white',
            plot_bgcolor: 'white',
            annotations: [{
                text: watermarkText, xref: "paper", yref: "paper", x: 1, y: -0.1,
                showarrow: false, font: { family: "Playfair Display", size: 14, color: "#ccc", weight: "bold" },
                xanchor: "right", yanchor: "bottom"
            }]
        };

        Plotly.newPlot('plot-matrix', data, layout, {responsive: true, displayModeBar: false});
    }

    function processMatrix() {
        const m = getMatrix();
        const det = calculateDeterminant(m);
        const inv = calculateInverse(m);

        document.getElementById('det-result').innerText = det.toFixed(2);
        
        const invBox = document.getElementById('inv-result');
        if (!inv) {
            invBox.innerHTML = "<div style='grid-column: span 3; color: red;'>No invertible (Det=0)</div>";
        } else {
            invBox.innerHTML = inv.flat().map(v => `<div>${v.toFixed(2)}</div>`).join('');
        }

        updatePlot(m);
    }

    async function downloadPlot() {
        const plot = document.getElementById('plot-matrix');
        
        // Efecto marca de agua gigante para descarga
        await Plotly.relayout(plot, {
            'annotations[0].font.size': 50,
            'annotations[0].font.color': 'rgba(0,0,0,0.1)'
        });

        await Plotly.downloadImage(plot, {
            format: 'png', width: 1200, height: 900,
            filename: 'analisis_matriz_raiz_cuadrada'
        });

        // Restaurar
        Plotly.relayout(plot, {
            'annotations[0].font.size': 14,
            'annotations[0].font.color': '#ccc'
        });
    }

    window.onload = processMatrix;
</script>
</body>
</html>
